================================================================================
                     CÃ‚U Há»I & TRáº¢ Lá»œI - Báº¢O Vá»† Dá»° ÃN
           REAL-TIME FRAUD DETECTION LAKEHOUSE WITH SPARK
================================================================================

TÃ¡c giáº£: [TÃªn sinh viÃªn]
GVHD: [TÃªn giáº£ng viÃªn]
NgÃ y cáº­p nháº­t: 13/12/2025

================================================================================
                        PHáº¦N 1: KIáº¾N TRÃšC Há»† THá»NG
================================================================================

Q1: Giáº£i thÃ­ch luá»“ng dá»¯ liá»‡u qua cÃ¡c táº§ng PostgreSQL â†’ Kafka â†’ Bronze â†’ Silver â†’ Gold?
---------------------------------------------------------------------------------------
ÄÃP:

Há»‡ thá»‘ng sá»­ dá»¥ng kiáº¿n trÃºc Lakehouse vá»›i 5 táº§ng xá»­ lÃ½ dá»¯ liá»‡u:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Táº¦NG 1: PostgreSQL (OLTP - Source of Truth)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Role: LÆ°u trá»¯ giao dá»‹ch thá»±c táº¿ (transactions table)                    â”‚
â”‚ - Schema: 24 columns (raw data tá»« Sparkov dataset)                        â”‚
â”‚   + trans_num (VARCHAR): Transaction ID                                   â”‚
â”‚   + cc_num (BIGINT): Credit card number                                   â”‚
â”‚   + amt (NUMERIC): Transaction amount                                     â”‚
â”‚   + merchant (VARCHAR): Merchant name                                     â”‚
â”‚   + category (VARCHAR): Transaction category                              â”‚
â”‚   + trans_date_trans_time (TIMESTAMP): Transaction timestamp              â”‚
â”‚   + first, last (VARCHAR): Customer name                                  â”‚
â”‚   + gender (CHAR): M/F                                                    â”‚
â”‚   + lat, long (DOUBLE): Customer location                                 â”‚
â”‚   + merch_lat, merch_long (DOUBLE): Merchant location                     â”‚
â”‚   + city, state, zip (VARCHAR/INT): Location details                      â”‚
â”‚   + job (VARCHAR): Customer job                                           â”‚
â”‚   + dob (DATE): Date of birth                                             â”‚
â”‚   + is_fraud (SMALLINT): Ground truth label (0/1)                         â”‚
â”‚                                                                            â”‚
â”‚ - Data Volume: ~287,000 transactions (training dataset)                   â”‚
â”‚ - Insert Method:                                                           â”‚
â”‚   + Manual: CSV batch upload                                              â”‚
â”‚   + Auto: data-producer container streaming tá»« fraudTrain.csv             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â†“ Debezium CDC

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Táº¦NG 2: Kafka Topics (Streaming Layer)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Topic: postgres.public.transactions                                        â”‚
â”‚ - Format: Debezium CDC JSON                                                â”‚
â”‚ - Message Structure:                                                       â”‚
â”‚   {                                                                        â”‚
â”‚     "before": null,                                                        â”‚
â”‚     "after": {                                                             â”‚
â”‚       "trans_num": "abc123...",                                            â”‚
â”‚       "amt": 1200.50,                                                      â”‚
â”‚       "trans_date_trans_time": 1702451234567890,  // microseconds         â”‚
â”‚       ... (all 24 columns)                                                 â”‚
â”‚     },                                                                     â”‚
â”‚     "op": "c",  // c=create, u=update, d=delete                           â”‚
â”‚     "ts_ms": 1702451234567                                                 â”‚
â”‚   }                                                                        â”‚
â”‚                                                                            â”‚
â”‚ - Retention: 7 days (configurable)                                        â”‚
â”‚ - Partitions: 1 (single broker setup)                                     â”‚
â”‚ - Consumers:                                                               â”‚
â”‚   1. bronze-streaming job (writes to Bronze layer)                        â”‚
â”‚   2. spark-realtime-prediction job (for real-time fraud detection)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â†“ Spark Structured Streaming (Bronze Job)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Táº¦NG 3: Bronze Layer (Raw Events - Delta Lake)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path: s3a://lakehouse/bronze/transactions                                 â”‚
â”‚                                                                            â”‚
â”‚ Transformations:                                                           â”‚
â”‚   1. Parse Debezium JSON â†’ Extract "after" payload                        â”‚
â”‚   2. Convert microseconds timestamp â†’ proper TIMESTAMP type                â”‚
â”‚   3. Type casting:                                                         â”‚
â”‚      - String â†’ BIGINT (cc_num)                                            â”‚
â”‚      - String â†’ DOUBLE (lat, long, merch_lat, merch_long)                 â”‚
â”‚      - BIGINT microseconds â†’ TIMESTAMP (trans_date_trans_time)             â”‚
â”‚   4. Add metadata columns:                                                 â”‚
â”‚      - ingestion_time: TIMESTAMP (khi write vÃ o Bronze)                   â”‚
â”‚      - year, month, day: INT (partition keys tá»« trans_timestamp)          â”‚
â”‚                                                                            â”‚
â”‚ Schema: 27 columns (24 raw + 3 metadata)                                  â”‚
â”‚   = All 24 columns from PostgreSQL                                        â”‚
â”‚   + trans_timestamp (converted from microseconds)                          â”‚
â”‚   + ingestion_time (current timestamp)                                     â”‚
â”‚   + year, month, day (partition columns)                                   â”‚
â”‚                                                                            â”‚
â”‚ Format: Delta Lake (ACID transactions, time travel)                       â”‚
â”‚ Partitioning: PARTITIONED BY (year, month, day)                           â”‚
â”‚ Write Mode: Append (streaming micro-batches má»—i 10 giÃ¢y)                  â”‚
â”‚                                                                            â”‚
â”‚ Data Quality: Raw data giá»¯ nguyÃªn, chÆ°a clean                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                               â†“ Spark Batch Job (Silver Job)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Táº¦NG 4: Silver Layer (Feature Engineered - Delta Lake)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path: s3a://lakehouse/silver/transactions                                 â”‚
â”‚                                                                            â”‚
â”‚ Feature Engineering Pipeline:                                              â”‚
â”‚                                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ A. GEOGRAPHIC FEATURES (2 features)                                 â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1. distance_km (DOUBLE):                                            â”‚   â”‚
â”‚ â”‚    = haversine_distance(customer_lat, customer_long,                â”‚   â”‚
â”‚ â”‚                         merchant_lat, merchant_long)                â”‚   â”‚
â”‚ â”‚    Formula:                                                          â”‚   â”‚
â”‚ â”‚      R = 6371  # Earth radius (km)                                  â”‚   â”‚
â”‚ â”‚      Ï†1 = radians(lat1)                                             â”‚   â”‚
â”‚ â”‚      Ï†2 = radians(lat2)                                             â”‚   â”‚
â”‚ â”‚      Î”Ï† = radians(lat2 - lat1)                                      â”‚   â”‚
â”‚ â”‚      Î”Î» = radians(lon2 - lon1)                                      â”‚   â”‚
â”‚ â”‚      a = sin(Î”Ï†/2)Â² + cos(Ï†1)*cos(Ï†2)*sin(Î”Î»/2)Â²                   â”‚   â”‚
â”‚ â”‚      c = 2 * atan2(âˆša, âˆš(1-a))                                      â”‚   â”‚
â”‚ â”‚      distance = R * c                                               â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 2. is_distant_transaction (INT): 1 if distance_km > 100 else 0     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ B. DEMOGRAPHIC FEATURES (2 features)                                â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1. age (INT):                                                       â”‚   â”‚
â”‚ â”‚    = floor((current_date - dob) / 365.25)                          â”‚   â”‚
â”‚ â”‚    Handle: Debezium sends dob as days since epoch                  â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 2. gender_encoded (INT): 0 if gender='M' else 1                    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ C. TIME FEATURES (6 features)                                       â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1. hour (INT): extract hour from trans_timestamp (0-23)            â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 2. day_of_week (INT): 0=Monday, 6=Sunday                           â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 3. is_weekend (INT): 1 if day_of_week >= 5 else 0                 â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 4. is_late_night (INT): 1 if hour < 6 or hour >= 23 else 0        â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 5. hour_sin (DOUBLE): sin(2Ï€ * hour / 24)                          â”‚   â”‚
â”‚ â”‚    Purpose: Cyclic encoding - 23h gáº§n 0h (khÃ´ng pháº£i xa)          â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 6. hour_cos (DOUBLE): cos(2Ï€ * hour / 24)                          â”‚   â”‚
â”‚ â”‚    Purpose: HoÃ n thiá»‡n cyclic encoding (sin + cos = full circle)   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ D. AMOUNT FEATURES (5 features)                                     â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1. log_amount (DOUBLE):                                             â”‚   â”‚
â”‚ â”‚    = log(1 + amt)                                                   â”‚   â”‚
â”‚ â”‚    Purpose: Normalize skewed distribution (amt cÃ³ outliers lá»›n)    â”‚   â”‚
â”‚ â”‚    Handle: log(0) = log(1) = 0 (avoid undefined)                   â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 2. is_zero_amount (INT): 1 if amt == 0 else 0                      â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 3. is_high_amount (INT): 1 if amt > 500 else 0                     â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 4. amount_bin (INT): Binning theo risk levels                       â”‚   â”‚
â”‚ â”‚    = 0 if amt == 0                                                  â”‚   â”‚
â”‚ â”‚    = 1 if amt <= 100                                                â”‚   â”‚
â”‚ â”‚    = 2 if 100 < amt <= 300                                          â”‚   â”‚
â”‚ â”‚    = 3 if 300 < amt <= 500                                          â”‚   â”‚
â”‚ â”‚    = 4 if 500 < amt <= 1000                                         â”‚   â”‚
â”‚ â”‚    = 5 if amt > 1000                                                â”‚   â”‚
â”‚ â”‚                                                                      â”‚   â”‚
â”‚ â”‚ 5. amt (DOUBLE): Original amount (kept for reference)              â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                            â”‚
â”‚ FINAL SCHEMA: 46 columns                                                  â”‚
â”‚   = 24 raw columns (from Bronze)                                          â”‚
â”‚   + 3 metadata (trans_timestamp, ingestion_time, partition keys)          â”‚
â”‚   + 2 geographic features                                                  â”‚
â”‚   + 2 demographic features                                                 â”‚
â”‚   + 6 time features                                                        â”‚
â”‚   + 5 amount features                                                      â”‚
â”‚   + 4 partition metadata (year, month, day, hour)                         â”‚
â”‚                                                                            â”‚
â”‚ Format: Delta Lake                                                         â”‚
â”‚ Write Mode: Overwrite (daily batch update via Airflow)                    â”‚
â”‚ Update Frequency: Daily 3h sÃ¡ng (sau khi Bronze layer cÃ³ dá»¯ liá»‡u má»›i)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            â†“ Spark Batch Job (Gold Job)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Táº¦NG 5: Gold Layer (Business-Ready - Star Schema)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path: s3a://lakehouse/gold/                                               â”‚
â”‚                                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ FACT TABLE: fact_transactions                                         â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Columns: 20+ aggregated features                                      â”‚ â”‚
â”‚ â”‚   - transaction_key (trans_num) â†’ PK                                  â”‚ â”‚
â”‚ â”‚   - customer_key (cc_num) â†’ FK to dim_customer                        â”‚ â”‚
â”‚ â”‚   - time_key (yyyyMMddHH) â†’ FK to dim_time                            â”‚ â”‚
â”‚ â”‚   - location_key â†’ FK to dim_location                                 â”‚ â”‚
â”‚ â”‚   - merchant_key â†’ FK to dim_merchant                                 â”‚ â”‚
â”‚ â”‚   - transaction_amount (amt)                                          â”‚ â”‚
â”‚ â”‚   - is_fraud (LABEL for ML)                                           â”‚ â”‚
â”‚ â”‚   - distance_km                                                        â”‚ â”‚
â”‚ â”‚   - customer_age_at_transaction (age)                                 â”‚ â”‚
â”‚ â”‚   - log_amount, amount_bin                                            â”‚ â”‚
â”‚ â”‚   - is_distant_transaction, is_late_night, is_high_amount            â”‚ â”‚
â”‚ â”‚   - hour_sin, hour_cos                                                â”‚ â”‚
â”‚ â”‚   - fraud_probability (if predicted)                                  â”‚ â”‚
â”‚ â”‚   - risk_level (if predicted)                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ DIMENSION TABLES                                                       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ dim_customer:                                                          â”‚ â”‚
â”‚ â”‚   - customer_key (cc_num)                                             â”‚ â”‚
â”‚ â”‚   - first_name, last_name                                             â”‚ â”‚
â”‚ â”‚   - gender, age, dob                                                  â”‚ â”‚
â”‚ â”‚   - city, state, zip                                                  â”‚ â”‚
â”‚ â”‚   - job                                                               â”‚ â”‚
â”‚ â”‚   - customer_risk_score (calculated)                                  â”‚ â”‚
â”‚ â”‚                                                                        â”‚ â”‚
â”‚ â”‚ dim_merchant:                                                          â”‚ â”‚
â”‚ â”‚   - merchant_key (merchant name)                                      â”‚ â”‚
â”‚ â”‚   - merchant_name                                                     â”‚ â”‚
â”‚ â”‚   - category                                                          â”‚ â”‚
â”‚ â”‚   - merch_lat, merch_long                                             â”‚ â”‚
â”‚ â”‚   - merchant_fraud_rate (aggregated)                                  â”‚ â”‚
â”‚ â”‚                                                                        â”‚ â”‚
â”‚ â”‚ dim_time:                                                              â”‚ â”‚
â”‚ â”‚   - time_key (yyyyMMddHH)                                             â”‚ â”‚
â”‚ â”‚   - date, year, month, day                                            â”‚ â”‚
â”‚ â”‚   - hour, day_of_week, is_weekend                                     â”‚ â”‚
â”‚ â”‚   - time_period (morning/afternoon/evening/night)                     â”‚ â”‚
â”‚ â”‚                                                                        â”‚ â”‚
â”‚ â”‚ dim_location:                                                          â”‚ â”‚
â”‚ â”‚   - location_key                                                      â”‚ â”‚
â”‚ â”‚   - city, state, zip                                                  â”‚ â”‚
â”‚ â”‚   - lat, long                                                         â”‚ â”‚
â”‚ â”‚   - city_pop                                                          â”‚ â”‚
â”‚ â”‚   - state_fraud_rate (aggregated)                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ AGGREGATE TABLES (for Chatbot Analytics)                              â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ fraud_by_state:                                                        â”‚ â”‚
â”‚ â”‚   - state, total_transactions, fraud_count, fraud_rate               â”‚ â”‚
â”‚ â”‚                                                                        â”‚ â”‚
â”‚ â”‚ fraud_by_merchant:                                                     â”‚ â”‚
â”‚ â”‚   - merchant, category, total_trans, fraud_count, fraud_rate         â”‚ â”‚
â”‚ â”‚                                                                        â”‚ â”‚
â”‚ â”‚ fraud_by_hour:                                                         â”‚ â”‚
â”‚ â”‚   - hour, total_transactions, fraud_count, fraud_rate                â”‚ â”‚
â”‚ â”‚                                                                        â”‚ â”‚
â”‚ â”‚ fraud_by_category:                                                     â”‚ â”‚
â”‚ â”‚   - category, total_transactions, fraud_count, fraud_rate            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚
â”‚ Format: Delta Lake + Trino-queryable views                                â”‚
â”‚ Update: Daily 4h sÃ¡ng (sau Silver layer update)                           â”‚
â”‚ Query Engine: Trino (distributed SQL)                                     â”‚
â”‚ Consumer: Chatbot Agent (QueryDatabase tool), Metabase dashboards         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Tá»”NG Káº¾T FEATURES QUA CÃC Táº¦NG:
================================
PostgreSQL:    24 columns (raw transaction data)
                â†“
Kafka:         24 columns (CDC events)
                â†“
Bronze:        27 columns (24 raw + 3 metadata)
                â†“
Silver:        46 columns (27 Bronze + 15 engineered features + 4 partition)
                â†“
Gold:          20+ columns (fact) + 4 dimension tables + aggregate views


LABEL (TARGET VARIABLE):
========================
- Column: is_fraud
- Type: SMALLINT (0 or 1)
- Source: Ground truth tá»« Sparkov dataset
- Values:
  * 0 = Normal transaction (legitimate)
  * 1 = Fraud transaction
- Distribution:
  * Original: 287K normal, 8K fraud (35:1 imbalance)
  * After balancing: 8K normal, 8K fraud (1:1 ratio for training)


================================================================================
                    PHáº¦N 2: MACHINE LEARNING PIPELINE
================================================================================

Q2: Model sá»­ dá»¥ng RandomForest hay Logistic Regression? Giáº£i thÃ­ch fraud_probability tÃ­nh nhÆ° tháº¿ nÃ o?
-------------------------------------------------------------------------------------------------------
ÄÃP:

Há»‡ thá»‘ng train 2 models nhÆ°ng CHá»ŒN RANDOMFOREST lÃ m Production model:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MODEL 1: RandomForestClassifier (PRODUCTION - Default)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MLflow Name: sklearn_fraud_randomforest                                    â”‚
â”‚ Stage: Production                                                           â”‚
â”‚                                                                            â”‚
â”‚ Hyperparameters:                                                           â”‚
â”‚   - n_estimators: 200 trees                                                â”‚
â”‚   - max_depth: 30 levels                                                   â”‚
â”‚   - min_samples_split: 2                                                   â”‚
â”‚   - random_state: 42                                                       â”‚
â”‚   - n_jobs: -1 (use all CPU cores)                                        â”‚
â”‚                                                                            â”‚
â”‚ Performance:                                                               â”‚
â”‚   - Accuracy:  0.928 (92.8%)                                               â”‚
â”‚   - Precision: 0.95  (95% khi nÃ³i fraud lÃ  Ä‘Ãºng fraud)                    â”‚
â”‚   - Recall:    0.88  (88% fraud Ä‘Æ°á»£c phÃ¡t hiá»‡n)                           â”‚
â”‚   - F1-Score:  0.91  (harmonic mean cá»§a precision & recall)               â”‚
â”‚   - AUC-ROC:   0.984 (98.4% kháº£ nÄƒng phÃ¢n biá»‡t fraud/normal)              â”‚
â”‚                                                                            â”‚
â”‚ Training Data:                                                             â”‚
â”‚   - 287,301 transactions (after undersampling 1:1)                        â”‚
â”‚   - 15 features (engineered from Silver layer)                            â”‚
â”‚   - 80/20 train-test split                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MODEL 2: LogisticRegression (ALTERNATIVE - Staging)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MLflow Name: sklearn_fraud_logistic                                        â”‚
â”‚ Stage: Staging (khÃ´ng dÃ¹ng máº·c Ä‘á»‹nh)                                       â”‚
â”‚                                                                            â”‚
â”‚ Hyperparameters:                                                           â”‚
â”‚   - penalty: 'l2' (L2 regularization)                                     â”‚
â”‚   - C: 1.0 (inverse regularization strength)                              â”‚
â”‚   - max_iter: 1000                                                         â”‚
â”‚   - solver: 'lbfgs'                                                        â”‚
â”‚                                                                            â”‚
â”‚ Performance:                                                               â”‚
â”‚   - Accuracy:  ~0.85 (85%)                                                 â”‚
â”‚   - AUC-ROC:   ~0.92 (92%)                                                 â”‚
â”‚                                                                            â”‚
â”‚ LÃ½ do KHÃ”NG chá»n lÃ m Production:                                          â”‚
â”‚   - Performance tháº¥p hÆ¡n RandomForest                                      â”‚
â”‚   - Fraud detection cáº§n recall cao (khÃ´ng bá» sÃ³t)                         â”‚
â”‚   - RandomForest handle non-linear patterns tá»‘t hÆ¡n                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


CÃCH TÃNH FRAUD_PROBABILITY:
=============================

RandomForest predict_proba() workflow:

Step 1: Input Features (15 dimensions)
---------------------------------------
X = [
    amt,              # 1200.0
    log_amount,       # 7.09
    amount_bin,       # 5
    is_zero_amount,   # 0
    is_high_amount,   # 1
    distance_km,      # 150.0
    is_distant_trans, # 1
    age,              # 35
    gender_encoded,   # 0 (Male)
    hour,             # 2 (2h sÃ¡ng)
    day_of_week,      # 3 (Thursday)
    is_weekend,       # 0
    is_late_night,    # 1
    hour_sin,         # 0.5
    hour_cos          # -0.866
]

Step 2: 200 Trees Vote
-----------------------
Model cÃ³ 200 cÃ¢y quyáº¿t Ä‘á»‹nh (decision trees).
Má»—i cÃ¢y Ä‘á»™c láº­p phÃ¢n loáº¡i giao dá»‹ch:

Tree 1:  FRAUD (1)     â† Vote cho FRAUD
Tree 2:  FRAUD (1)     â† Vote cho FRAUD
Tree 3:  NORMAL (0)    â† Vote cho NORMAL
Tree 4:  FRAUD (1)     â† Vote cho FRAUD
...
Tree 198: FRAUD (1)
Tree 199: FRAUD (1)
Tree 200: NORMAL (0)

VÃ­ dá»¥ káº¿t quáº£: 170 trees vote FRAUD, 30 trees vote NORMAL

Step 3: Calculate Probability
------------------------------
fraud_probability = (sá»‘ cÃ¢y vote FRAUD) / (tá»•ng sá»‘ cÃ¢y)
                  = 170 / 200
                  = 0.85
                  = 85%

Step 4: Thresholds & Risk Levels
---------------------------------
if fraud_probability > 0.7:
    risk_level = "HIGH"       # ğŸ”´ Cáº§n hÃ nh Ä‘á»™ng ngay
    is_fraud_predicted = 1
    
elif fraud_probability > 0.5:
    risk_level = "MEDIUM"     # ğŸŸ¡ Cáº£nh bÃ¡o, theo dÃµi
    is_fraud_predicted = 1
    
else:
    risk_level = "LOW"        # ğŸŸ¢ An toÃ n
    is_fraud_predicted = 0


CÃCH HIá»‚U Tá»¶ Lá»† PHáº¦N TRÄ‚M:
===========================

fraud_probability = 85% nghÄ©a lÃ :
- 85% cÃ¢y trong forest nghÄ© giao dá»‹ch lÃ  FRAUD
- Model tá»± tin 85% Ä‘Ã¢y lÃ  gian láº­n
- XÃ¡c suáº¥t giao dá»‹ch lÃ  fraud = 0.85

VÃ­ dá»¥ minh há»a:
---------------
1. Giao dá»‹ch $50 lÃºc 2h chiá»u, gáº§n nhÃ  (10km):
   â†’ 20/200 cÃ¢y vote FRAUD = 10% probability
   â†’ Risk: LOW, is_fraud_predicted = 0

2. Giao dá»‹ch $850 lÃºc 2h sÃ¡ng, xa 150km:
   â†’ 125/200 cÃ¢y vote FRAUD = 62.5% probability
   â†’ Risk: MEDIUM, is_fraud_predicted = 1

3. Giao dá»‹ch $2500 lÃºc 3h sÃ¡ng, xa 300km:
   â†’ 185/200 cÃ¢y vote FRAUD = 92.5% probability
   â†’ Risk: HIGH, is_fraud_predicted = 1


Táº I SAO DÃ™NG RANDOMFOREST THAY VÃŒ LOGISTIC REGRESSION?
=======================================================

1. Non-linear Patterns:
   - Fraud cÃ³ patterns phá»©c táº¡p (khÃ´ng tuyáº¿n tÃ­nh)
   - RandomForest handle tá»‘t interactions giá»¯a features
     VÃ­ dá»¥: (amt > 1000) AND (hour < 6) AND (distance > 100)
   - Logistic Regression chá»‰ tá»‘t vá»›i linear relationships

2. Feature Importance:
   - RandomForest cho biáº¿t feature nÃ o quan trá»ng nháº¥t
   - Top features: amt (25%), distance_km (18%), is_late_night (12%)

3. Robustness:
   - RandomForest Ã­t bá»‹ overfitting (ensemble cá»§a 200 trees)
   - Xá»­ lÃ½ outliers tá»‘t hÆ¡n

4. Interpretability:
   - predict_proba() dá»… giáº£i thÃ­ch: "85% cÃ¢y nghÄ© lÃ  fraud"
   - Logistic regression: sigmoid(z) khÃ³ giáº£i thÃ­ch cho non-tech users

5. Performance:
   - RandomForest: AUC 98.4%, Accuracy 92.8%
   - Logistic:     AUC 92%,   Accuracy 85%


CODE IMPLEMENTATION (FastAPI):
===============================

```python
# services/fraud-detection-api/app/main.py

# Predict endpoint
is_fraud = int(loaded_model.predict(X)[0])        # 0 or 1
proba = loaded_model.predict_proba(X)[0]          # [P(normal), P(fraud)]
fraud_probability = float(proba[1])               # Get P(fraud)

# Risk classification
if fraud_probability > 0.7:
    risk_level = "HIGH"
elif fraud_probability > 0.5:
    risk_level = "MEDIUM"
else:
    risk_level = "LOW"

return {
    "is_fraud_predicted": is_fraud,
    "fraud_probability": fraud_probability,
    "risk_level": risk_level,
    "model_version": "sklearn_fraud_randomforest_v3"
}
```


================================================================================
                    PHáº¦N 3: FEATURES & LABELS CHI TIáº¾T
================================================================================

Q3: CÃ³ bao nhiÃªu features? Input features vÃ  output features lÃ  gÃ¬?
---------------------------------------------------------------------
ÄÃP:

Tá»”NG QUAN FEATURES:
===================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer                â”‚ Columns  â”‚ Purpose                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PostgreSQL (Raw)     â”‚ 24       â”‚ Source data tá»« Sparkov dataset         â”‚
â”‚ Bronze (Streaming)   â”‚ 27       â”‚ Raw + metadata (ingestion_time, etc)   â”‚
â”‚ Silver (Engineered)  â”‚ 46       â”‚ Raw + 15 engineered + 4 partition      â”‚
â”‚ Gold (Business)      â”‚ 20+      â”‚ Fact table + dimensions                â”‚
â”‚ ML Model Input       â”‚ 15       â”‚ Selected features for training         â”‚
â”‚ ML Model Output      â”‚ 3        â”‚ Prediction results                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ML MODEL FEATURES (15 INPUT FEATURES):
=======================================

ÄÆ°á»£c chá»n tá»« Silver layer Ä‘á»ƒ train model:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature Name          â”‚ Type   â”‚ Description                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AMOUNT FEATURES (5):                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. amt                â”‚ DOUBLE â”‚ Original transaction amount ($)        â”‚
â”‚ 2. log_amount         â”‚ DOUBLE â”‚ log(1 + amt) - normalized              â”‚
â”‚ 3. amount_bin         â”‚ INT    â”‚ Binned amount (0-5 risk levels)        â”‚
â”‚ 4. is_zero_amount     â”‚ INT    â”‚ 1 if amt==0, else 0                    â”‚
â”‚ 5. is_high_amount     â”‚ INT    â”‚ 1 if amt>500, else 0                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GEOGRAPHIC FEATURES (2):                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6. distance_km        â”‚ DOUBLE â”‚ Haversine distance (customer-merchant) â”‚
â”‚ 7. is_distant_trans   â”‚ INT    â”‚ 1 if distance>100km, else 0            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DEMOGRAPHIC FEATURES (2):                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 8. age                â”‚ INT    â”‚ Customer age (calculated from DOB)     â”‚
â”‚ 9. gender_encoded     â”‚ INT    â”‚ 0=Male, 1=Female                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TIME FEATURES (6):                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10. hour              â”‚ INT    â”‚ Hour of transaction (0-23)             â”‚
â”‚ 11. day_of_week       â”‚ INT    â”‚ Day of week (0=Mon, 6=Sun)             â”‚
â”‚ 12. is_weekend        â”‚ INT    â”‚ 1 if Saturday/Sunday, else 0           â”‚
â”‚ 13. is_late_night     â”‚ INT    â”‚ 1 if hour<6 or hour>=23, else 0        â”‚
â”‚ 14. hour_sin          â”‚ DOUBLE â”‚ sin(2Ï€*hour/24) - cyclic encoding      â”‚
â”‚ 15. hour_cos          â”‚ DOUBLE â”‚ cos(2Ï€*hour/24) - cyclic encoding      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Feature Vector Example:
-----------------------
Transaction: $1200 at 2AM, 150km from home, customer 35 years old Male

X = [
    1200.0,    # amt
    7.09,      # log_amount = log(1+1200)
    5,         # amount_bin (>$1000)
    0,         # is_zero_amount
    1,         # is_high_amount (>$500)
    150.0,     # distance_km
    1,         # is_distant_transaction (>100km)
    35,        # age
    0,         # gender_encoded (Male=0)
    2,         # hour (2AM)
    3,         # day_of_week (Thursday)
    0,         # is_weekend (no)
    1,         # is_late_night (2AM < 6)
    0.5,       # hour_sin
    -0.866     # hour_cos
]


LABEL (TARGET VARIABLE):
========================
- Column: is_fraud
- Type: SMALLINT (0 or 1)
- Values:
  * 0 = Normal (legitimate transaction)
  * 1 = Fraud
- Distribution (training set):
  * Before balancing: 35:1 (normal:fraud)
  * After undersampling: 1:1 (balanced for training)


MODEL OUTPUT (3 VALUES):
========================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Output Field           â”‚ Type   â”‚ Description                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. is_fraud_predicted  â”‚ INT    â”‚ 0 (Normal) or 1 (Fraud)             â”‚
â”‚                        â”‚        â”‚ Threshold: > 0.5 probability        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. fraud_probability   â”‚ FLOAT  â”‚ 0.0 to 1.0 (0% to 100%)             â”‚
â”‚                        â”‚        â”‚ = votes_fraud / 200 trees           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. risk_level          â”‚ STRING â”‚ "LOW"    if prob < 0.5              â”‚
â”‚                        â”‚        â”‚ "MEDIUM" if 0.5 <= prob < 0.7       â”‚
â”‚                        â”‚        â”‚ "HIGH"   if prob >= 0.7             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example Outputs:
----------------
1. Normal Transaction ($50, 2PM, 5km):
   {
     "is_fraud_predicted": 0,
     "fraud_probability": 0.15,
     "risk_level": "LOW"
   }

2. Suspicious Transaction ($850, 2AM, 150km):
   {
     "is_fraud_predicted": 1,
     "fraud_probability": 0.625,
     "risk_level": "MEDIUM"
   }

3. High-Risk Transaction ($2500, 3AM, 300km):
   {
     "is_fraud_predicted": 1,
     "fraud_probability": 0.925,
     "risk_level": "HIGH"
   }


Táº I SAO CHá»ˆ CHá»ŒN 15 FEATURES Tá»ª 46 COLUMNS?
============================================

1. Feature Selection Strategy:
   - Loáº¡i bá» raw strings (merchant, category) - khÃ´ng numeric
   - Loáº¡i bá» IDs (trans_num, cc_num) - khÃ´ng cÃ³ predictive power
   - Loáº¡i bá» location raw (lat, long) - Ä‘Ã£ cÃ³ distance_km
   - Chá»‰ giá»¯ engineered features cÃ³ high correlation vá»›i fraud

2. Curse of Dimensionality:
   - QuÃ¡ nhiá»u features â†’ overfitting
   - 15 features Ä‘á»§ Ä‘á»ƒ model há»c patterns mÃ  khÃ´ng bá»‹ noise

3. Feature Importance Analysis:
   - Top 5 features chiáº¿m 70% importance:
     * amt (25%)
     * distance_km (18%)
     * log_amount (15%)
     * is_late_night (12%)
     * amount_bin (10%)

4. Computational Efficiency:
   - Ãt features â†’ train nhanh hÆ¡n
   - Real-time prediction < 100ms


================================================================================
                    PHáº¦N 4: CHATBOT TARGET USERS
================================================================================

Q4: Chatbot nÃ y cho ai dÃ¹ng? Giáº£i thÃ­ch vá»›i context bÃ i cá»§a tÃ´i.
-----------------------------------------------------------------
ÄÃP:

CHATBOT ÄÆ¯á»¢C THIáº¾T Káº¾ CHO 2 Äá»I TÆ¯á»¢NG CHÃNH:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Äá»I TÆ¯á»¢NG 1: FRAUD ANALYSTS (ChuyÃªn viÃªn phÃ¢n tÃ­ch gian láº­n)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VAI TRÃ’:                                                                   â”‚
â”‚   - Äiá»u tra cÃ¡c giao dá»‹ch nghi ngá»                                       â”‚
â”‚   - XÃ¡c minh fraud alerts tá»« real-time system                             â”‚
â”‚   - PhÃ¢n tÃ­ch patterns vÃ  trends gian láº­n                                 â”‚
â”‚   - Quyáº¿t Ä‘á»‹nh block/approve cÃ¡c giao dá»‹ch high-risk                      â”‚
â”‚                                                                            â”‚
â”‚ CÃ”NG VIá»†C HÃ€NG NGÃ€Y:                                                       â”‚
â”‚   08:00 - Check Slack alerts tá»« Ä‘Ãªm qua                                   â”‚
â”‚          â†’ "ğŸš¨ 10 HIGH RISK transactions detected"                         â”‚
â”‚                                                                            â”‚
â”‚   08:15 - Má»Ÿ Chatbot, há»i:                                                â”‚
â”‚          "Cho tÃ´i danh sÃ¡ch 10 giao dá»‹ch fraud rate cao nháº¥t hÃ´m qua"    â”‚
â”‚          â†’ Chatbot query Gold layer â†’ Tráº£ vá» table + insights            â”‚
â”‚                                                                            â”‚
â”‚   09:00 - Äiá»u tra case cá»¥ thá»ƒ:                                           â”‚
â”‚          User: "Dá»± Ä‘oÃ¡n giao dá»‹ch $2500 lÃºc 3h sÃ¡ng tá»« California"       â”‚
â”‚          Bot:  [PredictFraud] â†’ "FRAUD 92%, HIGH RISK"                    â”‚
â”‚          Bot:  [QueryDatabase] â†’ "CA fraud rate = 8.2%"                   â”‚
â”‚          Bot:  ğŸ’¡ "Giao dá»‹ch Ráº¤T NGUY HIá»‚M - khuyáº¿n nghá»‹ tá»« chá»‘i"        â”‚
â”‚                                                                            â”‚
â”‚   10:00 - PhÃ¢n tÃ­ch merchant:                                              â”‚
â”‚          "Merchant XYZ cÃ³ fraud rate bao nhiÃªu?"                          â”‚
â”‚          â†’ Bot: "XYZ cÃ³ fraud rate 15.2% (gáº¥p 3 láº§n trung bÃ¬nh 5%)"      â”‚
â”‚                                                                            â”‚
â”‚   11:00 - So sÃ¡nh patterns:                                                â”‚
â”‚          "So sÃ¡nh fraud rate tuáº§n nÃ y vá»›i tuáº§n trÆ°á»›c"                     â”‚
â”‚          â†’ Bot tráº£ vá» trends + visualization insights                     â”‚
â”‚                                                                            â”‚
â”‚ Lá»¢I ÃCH:                                                                   â”‚
â”‚   âœ… KhÃ´ng cáº§n biáº¿t SQL â†’ Chat tiáº¿ng Viá»‡t tá»± nhiÃªn                        â”‚
â”‚   âœ… Káº¿t quáº£ real-time (<2s) tá»« Delta Lake                                â”‚
â”‚   âœ… AI explain insights â†’ Hiá»ƒu Táº I SAO fraud thay vÃ¬ chá»‰ con sá»‘          â”‚
â”‚   âœ… Káº¿t há»£p data + ML prediction trong 1 conversation                    â”‚
â”‚   âœ… LÆ°u conversation history â†’ Review láº¡i cases                          â”‚
â”‚                                                                            â”‚
â”‚ USE CASES Cá»¤ THá»‚:                                                          â”‚
â”‚   1. Alert Investigation:                                                  â”‚
â”‚      - Slack alert: "Transaction abc123 - HIGH RISK"                      â”‚
â”‚      - Analyst há»i chatbot: "ThÃ´ng tin giao dá»‹ch abc123"                 â”‚
â”‚      - Bot tráº£ vá»: Full context + prediction + explanation               â”‚
â”‚                                                                            â”‚
â”‚   2. Pattern Discovery:                                                    â”‚
â”‚      - "Merchant nÃ o á»Ÿ California cÃ³ fraud rate >10%?"                    â”‚
â”‚      - "Giá» nÃ o hay xáº£y ra fraud nháº¥t?"                                  â”‚
â”‚      - "Fraud rate theo category"                                         â”‚
â”‚                                                                            â”‚
â”‚   3. Risk Assessment:                                                      â”‚
â”‚      - Customer gá»i phone: "TÃ´i vá»«a thanh toÃ¡n $1200 lÃºc 2h sÃ¡ng"        â”‚
â”‚      - Analyst há»i bot: "Dá»± Ä‘oÃ¡n giao dá»‹ch $1200 lÃºc 2AM"                â”‚
â”‚      - Bot: "65% fraud probability - cáº§n verify OTP"                      â”‚
â”‚                                                                            â”‚
â”‚   4. Comparative Analysis:                                                 â”‚
â”‚      - "So sÃ¡nh fraud rate: CA vs TX vs NY"                               â”‚
â”‚      - "Xu hÆ°á»›ng fraud 30 ngÃ y qua"                                       â”‚
â”‚      - "Impact cá»§a late-night transactions"                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Äá»I TÆ¯á»¢NG 2: DATA ANALYSTS (ChuyÃªn viÃªn phÃ¢n tÃ­ch dá»¯ liá»‡u)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VAI TRÃ’:                                                                   â”‚
â”‚   - Táº¡o reports Ä‘á»‹nh ká»³ cho management                                    â”‚
â”‚   - PhÃ¢n tÃ­ch business metrics vÃ  KPIs                                     â”‚
â”‚   - TÃ¬m insights Ä‘á»ƒ improve fraud detection system                        â”‚
â”‚   - Validate model performance vÃ  suggest improvements                     â”‚
â”‚                                                                            â”‚
â”‚ CÃ”NG VIá»†C HÃ€NG TUáº¦N:                                                       â”‚
â”‚   Monday Morning - Weekly Report:                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚   User: "TÃ³m táº¯t fraud metrics tuáº§n qua"                                  â”‚
â”‚   Bot:  [Query Gold layer aggregates]                                     â”‚
â”‚         â†’ Total transactions: 45,230                                       â”‚
â”‚         â†’ Fraud detected: 2,315 (5.1%)                                    â”‚
â”‚         â†’ TOP risk states: AK (14.3%), CA (8.2%), TX (7.8%)              â”‚
â”‚         â†’ Most dangerous hour: 2-4AM (18% fraud rate)                     â”‚
â”‚                                                                            â”‚
â”‚   Tuesday - Merchant Analysis:                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚   User: "Top 10 merchants cÃ³ fraud rate cao nháº¥t"                         â”‚
â”‚   Bot:  [QueryDatabase] â†’ Table + Insights:                               â”‚
â”‚         1. ABC Corp - 15.2% (Ä‘á» xuáº¥t blacklist)                           â”‚
â”‚         2. XYZ Store - 12.8%                                              â”‚
â”‚         ...                                                                â”‚
â”‚                                                                            â”‚
â”‚   Wednesday - Model Performance:                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚   User: "ThÃ´ng tin model hiá»‡n táº¡i"                                        â”‚
â”‚   Bot:  [GetModelInfo]                                                    â”‚
â”‚         â†’ Model: sklearn_fraud_randomforest v3                            â”‚
â”‚         â†’ Accuracy: 92.8%, AUC: 98.4%                                     â”‚
â”‚         â†’ Trained on: 2025-12-10                                          â”‚
â”‚         â†’ 15 features used                                                â”‚
â”‚                                                                            â”‚
â”‚   Thursday - Trend Analysis:                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚   User: "Xu hÆ°á»›ng fraud 90 ngÃ y qua"                                      â”‚
â”‚   Bot:  [Complex SQL aggregation] â†’ Line chart insights                   â”‚
â”‚         ğŸ’¡ "Fraud tÄƒng 0.8% trong Q4, Ä‘áº·c biá»‡t cao vÃ o holiday season"   â”‚
â”‚                                                                            â”‚
â”‚   Friday - Ad-hoc Queries:                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚   Boss há»i: "Fraud rate cá»§a category shopping_net vs gas_transport?"     â”‚
â”‚   Analyst dÃ¹ng chatbot thay vÃ¬ viáº¿t SQL:                                  â”‚
â”‚   â†’ Bot tráº£ lá»i ngay vá»›i comparison table + insights                      â”‚
â”‚                                                                            â”‚
â”‚ Lá»¢I ÃCH:                                                                   â”‚
â”‚   âœ… Self-service analytics â†’ KhÃ´ng cáº§n Data Engineer viáº¿t query          â”‚
â”‚   âœ… Natural language â†’ KhÃ´ng cáº§n nhá»› schema, table names                 â”‚
â”‚   âœ… AI-generated insights â†’ KhÃ´ng chá»‰ data, cÃ²n cÃ³ explanation           â”‚
â”‚   âœ… Fast iteration â†’ Test hypotheses nhanh (khÃ´ng cáº§n viáº¿t Python)       â”‚
â”‚   âœ… Reproducible â†’ Session history â†’ Share vá»›i team                      â”‚
â”‚                                                                            â”‚
â”‚ USE CASES Cá»¤ THá»‚:                                                          â”‚
â”‚   1. Business Intelligence:                                                â”‚
â”‚      - "Revenue loss tá»« fraud transactions thÃ¡ng nÃ y?"                    â”‚
â”‚      - "Fraud rate theo customer age groups"                              â”‚
â”‚      - "Impact cá»§a fraud detection system lÃªn false positives"            â”‚
â”‚                                                                            â”‚
â”‚   2. Model Validation:                                                     â”‚
â”‚      - "So sÃ¡nh prediction accuracy cá»§a model v2 vs v3"                   â”‚
â”‚      - "Precision-Recall trade-off hiá»‡n táº¡i"                              â”‚
â”‚      - "Feature importance cÃ³ thay Ä‘á»•i khÃ´ng?"                            â”‚
â”‚                                                                            â”‚
â”‚   3. A/B Testing:                                                          â”‚
â”‚      - "Náº¿u tÄƒng threshold tá»« 0.5 lÃªn 0.7 thÃ¬ áº£nh hÆ°á»Ÿng gÃ¬?"            â”‚
â”‚      - "Test prediction trÃªn sample má»›i"                                  â”‚
â”‚                                                                            â”‚
â”‚   4. Root Cause Analysis:                                                  â”‚
â”‚      - "Táº¡i sao fraud rate tÄƒng Ä‘á»™t biáº¿n tuáº§n trÆ°á»›c?"                    â”‚
â”‚      - "Merchant nÃ o drive fraud spike?"                                  â”‚
â”‚      - "CÃ³ correlation giá»¯a distance vÃ  fraud khÃ´ng?"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Táº I SAO CHATBOT PHÃ™ Há»¢P Vá»šI 2 Äá»I TÆ¯á»¢NG NÃ€Y?
=============================================

1. FRAUD ANALYSTS:
   âœ… Real-time decision making
      - Alert investigation trong 2-3 phÃºt
      - KhÃ´ng Ä‘á»£i Data team viáº¿t query
   
   âœ… Technical barrier tháº¥p
      - KhÃ´ng cáº§n biáº¿t SQL, Python
      - Chat tiáº¿ng Viá»‡t tá»± nhiÃªn
   
   âœ… Context-aware
      - Agent nhá»› conversation history
      - CÃ³ thá»ƒ há»i follow-up: "ThÃ´ng tin vá» bang Ä‘Ã³?"
   
   âœ… Actionable insights
      - KhÃ´ng chá»‰ sá»‘ liá»‡u, cÃ²n cÃ³ recommendations
      - "Khuyáº¿n nghá»‹ tá»« chá»‘i giao dá»‹ch" hoáº·c "Cáº§n verify OTP"

2. DATA ANALYSTS:
   âœ… Self-service analytics
      - KhÃ´ng phá»¥ thuá»™c vÃ o Data Engineers
      - Query phá»©c táº¡p trong vÃ i giÃ¢y
   
   âœ… Exploratory Analysis
      - Test hypotheses nhanh
      - Iterate queries dá»… dÃ ng
   
   âœ… Natural language interface
      - KhÃ´ng cáº§n nhá»› schema Delta Lake
      - KhÃ´ng cáº§n viáº¿t PySpark/SQL
   
   âœ… AI-powered insights
      - Gemini LLM generate explanations
      - Tá»± Ä‘á»™ng phÃ¡t hiá»‡n patterns


SO SÃNH Vá»šI ALTERNATIVES:
==========================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Method       â”‚ Chatbot â”‚ Metabase â”‚ SQL      â”‚ Python      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tiáº¿ng Viá»‡t   â”‚ âœ…âœ…âœ…   â”‚ âŒ       â”‚ âŒ       â”‚ âŒ          â”‚
â”‚ Real-time    â”‚ âœ…âœ…     â”‚ âœ…âœ…      â”‚ âœ…âœ…      â”‚ âœ…          â”‚
â”‚ ML Predict   â”‚ âœ…âœ…âœ…   â”‚ âŒ       â”‚ âŒ       â”‚ âœ…âœ…âœ…       â”‚
â”‚ AI Insights  â”‚ âœ…âœ…âœ…   â”‚ âŒ       â”‚ âŒ       â”‚ âŒ          â”‚
â”‚ Easy to use  â”‚ âœ…âœ…âœ…   â”‚ âœ…âœ…      â”‚ âŒ       â”‚ âŒ          â”‚
â”‚ No training  â”‚ âœ…âœ…âœ…   â”‚ âœ…       â”‚ âŒâŒ      â”‚ âŒâŒ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


BUSINESS VALUE:
===============

1. Giáº£m Response Time:
   - Alert â†’ Action: 2-3 phÃºt (thay vÃ¬ 30-60 phÃºt)
   - Self-service â†’ KhÃ´ng Ä‘á»£i Data team

2. TÄƒng Fraud Detection Rate:
   - Analysts lÃ m viá»‡c hiá»‡u quáº£ hÆ¡n
   - CÃ³ tools Ä‘á»ƒ investigate nhanh

3. Reduce False Positives:
   - Verify prediction vá»›i historical data
   - Context-aware decision making

4. Knowledge Democratization:
   - Non-technical users access Delta Lake
   - No SQL training required


================================================================================
                            Káº¾T LUáº¬N
================================================================================

Há»‡ thá»‘ng Real-Time Fraud Detection Lakehouse Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i:

1. DATA ARCHITECTURE:
   - 5 layers: PostgreSQL â†’ Kafka â†’ Bronze â†’ Silver â†’ Gold
   - 24 raw columns â†’ 46 engineered columns â†’ 15 ML features
   - Delta Lake format vá»›i ACID transactions

2. ML PIPELINE:
   - RandomForest (Production): 200 trees, AUC 98.4%
   - Logistic Regression (Staging): Alternative model
   - fraud_probability = votes_fraud / 200 trees
   - Risk levels: LOW/MEDIUM/HIGH based on thresholds

3. FEATURES:
   - 15 input features: amount (5) + geographic (2) + demographic (2) + time (6)
   - 1 label: is_fraud (0/1)
   - 3 output values: is_fraud_predicted, fraud_probability, risk_level

4. CHATBOT:
   - Target users: Fraud Analysts + Data Analysts
   - LangChain ReAct Agent vá»›i 3 tools
   - Tiáº¿ng Viá»‡t, real-time, AI-powered insights
   - Self-service analytics khÃ´ng cáº§n SQL


NGÆ¯á»œI LÃ€M: [TÃªn sinh viÃªn]
NGÃ€Y: 13/12/2025

================================================================================
                              Háº¾T
================================================================================
